using System;using System.Diagnostics;using System.Collections.Generic;using System.Linq;using System.Text;using System.Threading.Tasks;using System.Xml.Linq;using SkiaSharp;using OpenCvSharp;using System.Runtime.InteropServices;using System.Threading;using static System.Net.Mime.MediaTypeNames;using System.IO;using OpenCvSharp.Extensions;using System.Drawing;using System.Windows.Forms;using Application=System.Windows.Forms.Application;using SkiaSharp.Views.Desktop;namespace a{internal class b{static public bool c=false;static d e=new d(1,1);static string f="S:\\Users\\mansu\\source\\repos\\Assembler2\\Assembler2\\SubwaySerf.ass2";static string g=@"";static Dictionary<string,string> h=new Dictionary<string,string>();static Dictionary<string,float> i=new Dictionary<string,float>();static void Main(string[] args){if(f!="")g=File.ReadAllText(f);int j=0;var k=SKSurface.Create(new SKImageInfo(400,300));SKCanvas l=k.Canvas;l.Clear(SKColors.White);while(j<g.Split(';').Length){string m=g.Split(';')[j];m=m.Trim();j++;if(m.StartsWith("include<window>")){float n=p(m.Split('(')[1].Split(',')[0]);float o=p(m.Split(',')[1].Split(')')[0]);q(n,o);}else if(m.StartsWith("newstr(")){string r=s(m.Split('(')[1].Split(')')[0]);t(r);}else if(m.StartsWith("setstr(")){string u=s(m.Split('(')[1].Split(',')[0]);string v=s(m.Split(',')[1].Split(')')[0]);w(u,v);}else if(m.StartsWith("setflt(")){string x=s(m.Split('(')[1].Split(',')[0]);float y=p(m.Split(',')[1].Split(')')[0]);z(x,y);}else if(m.StartsWith("newflt(")){string aa=s(m.Split('(')[1].Split(')')[0]);ab(aa);}else if(m.StartsWith("print(")){string ac=s(m.Split('(')[1].Split(')')[0]);Console.WriteLine(ac);}else if(m.StartsWith("printflt(")){float ad;string ae=m.Split('(')[1].Split(')')[0];if(ae.StartsWith("!")){string af=s(m.Split('(')[1].Split(')')[0]);ad=p("!"+af);}else{ad=p("!"+ae);}Console.WriteLine(ad);}else if(m.StartsWith("add")){float ag=p(m.Split('(')[1].Split(',')[0]);float ah=p(m.Split(',')[1]);string ai=s(m.Split(',')[2].Split(')')[0]);z(ai,ag+ah);}else if(m.StartsWith("sub")){float aj=p(m.Split('(')[1].Split(',')[0]);float ak=p(m.Split(',')[1]);string al=s(m.Split(',')[2].Split(')')[0]);z(al,aj-ak);}else if(m.StartsWith("mult")){float am=p(m.Split('(')[1].Split(',')[0]);float an=p(m.Split(',')[1]);string ao=s(m.Split(',')[2].Split(')')[0]);z(ao,am*an);}else if(m.StartsWith("div")){float ap=p(m.Split('(')[1].Split(',')[0]);float aq=p(m.Split(',')[1]);string ar=s(m.Split(',')[2].Split(')')[0]);z(ar,ap/aq);}else if(m.StartsWith("combine")){string as1=s(m.Split('(')[1].Split(',')[0]);string at=s(m.Split(',')[1]);string au=s(m.Split(',')[2].Split(')')[0]);w(au,as1+at);}else if(m.StartsWith("random")){float av=p(m.Split('(')[1].Split(',')[0]);float aw=p(m.Split(',')[1]);string ax=s(m.Split(',')[2].Split(')')[0]);z(ax,new Random().Next((int)av,(int)aw));}else if(m.StartsWith("str<flt")){string ay=s(m.Split('(')[1].Split(',')[0]);float az=p(m.Split(',')[1].Split(')')[0]);w(ay,az.ToString());}else if(m.StartsWith("goto")){string ba=s(m.Split('(')[1].Split(')')[0]);int bb=bc(g,ba);j=bb;}if(m.StartsWith("if>")){float bd=p(m.Split('(')[1].Split(',')[0]);float be=p(m.Split(',')[1]);string bf=s(m.Split(',')[2].Split(')')[0]);if(bd<=be){int bg=bc(g,bf);j=bg;}}else if(m.StartsWith("if<")){float bh=p(m.Split('(')[1].Split(',')[0]);float bi=p(m.Split(',')[1]);string bj=s(m.Split(',')[2].Split(')')[0]);if(bh>=bi){int bk=bc(g,bj);j=bk;}}else if(m.StartsWith("if=")){float bl=p(m.Split('(')[1].Split(',')[0]);float bm=p(m.Split(',')[1]);string bn=s(m.Split(',')[2].Split(')')[0]);if(bl==bm){int bo=bc(g,bn);j=bo;}}else if(m.StartsWith("if!=")){float bp=p(m.Split('(')[1].Split(',')[0]);float bq=p(m.Split(',')[1]);string br=s(m.Split(',')[2].Split(')')[0]);if(bp!=bq){int bs=bc(g,br);j=bs;}}else if(m.StartsWith("setsize")){float bt=p(m.Split('(')[1].Split(',')[0]);float bu=p(m.Split(',')[1].Split(')')[0]);using(var bv=new SKPaint{Color=SKColors.Red}){k=SKSurface.Create(new SKImageInfo((int)bt,(int)bu));l=k.Canvas;}}else if(m.StartsWith("paint")){float bw=p(m.Split('(')[1].Split(',')[0]);float bx=p(m.Split(',')[1]);float by=p(m.Split(',')[2]);float bz=p(m.Split(',')[3].Split(')')[0]);float ca=p(m.Split('/')[1]);float cb=p(m.Split('/')[2]);float cc=p(m.Split('/')[3].Replace(";",""));SKColor cd=new SKColor((byte)ca,(byte)cb,(byte)cc);using(var ce=new SKPaint{Color=cd}){l.DrawRect(bw,bx,by,bz,ce);}}else if(m.StartsWith("show")){float cf=p(m.Split('(')[1].Split(')')[0]);e.cg(k);System.Threading.Thread.Sleep((int)Math.Round(cf*10));}else if(m.StartsWith("if key")){string ch=s(m.Split('(')[1].Split(',')[0]);string ci=s(m.Split(',')[1].Split(')')[0]);if(cj(ch,out ConsoleKey ck))if(!cl(ck)){int cm=bc(g,ci);j=cm;}}else if(m.StartsWith("key")){string cn=s(m.Split('(')[1].Split(')')[0]);ConsoleKeyInfo co=Console.ReadKey();string cp="";cp=co.KeyChar.ToString();if(co.Key==ConsoleKey.Backspace)cp="BackSpace";if(co.Key==ConsoleKey.Enter)cp="\n";w(cn,cp.ToString());}else if(m.StartsWith("text")){float cq=p(m.Split('(')[1].Split(',')[0]);float cr=p(m.Split(',')[1]);float cs=p(m.Split(',')[2]);string ct=s(m.Split(',')[3].Split(')')[0]);float cu=p(m.Split('/')[1]);float cv=p(m.Split('/')[2]);float cw=p(m.Split('/')[3].Replace(";",""));SKColor cx=new SKColor((byte)cu,(byte)cv,(byte)cw);using(var cy=new SKPaint{Color=cx,TextSize=cs}){l.DrawText(ct,cq,cr,cy);}Cv2.WaitKey(0);Cv2.DestroyAllWindows();}}}public static bool cj(string cz,out ConsoleKey da){da=default;if(string.IsNullOrWhiteSpace(cz))return false;if(Enum.TryParse<ConsoleKey>(cz,true,out da)){return true;}if(cz.Length==1){char db=char.ToUpper(cz[0]);if(char.IsLetterOrDigit(db)){string dc=db.ToString();if(Enum.TryParse<ConsoleKey>(dc,true,out da)){return true;}}}switch(cz.ToLower()){case"enter":da=ConsoleKey.Enter;return true;case"space":case"spacebar":da=ConsoleKey.Spacebar;return true;case"esc":case"escape":da=ConsoleKey.Escape;return true;case"tab":da=ConsoleKey.Tab;return true;default:return false;}}private static IntPtr dd(LowLevelKeyboardProc de){using(Process df=Process.GetCurrentProcess())using(ProcessModule dg=df.MainModule){return SetWindowsHookEx(13,de,GetModuleHandle(dg.ModuleName),0);}}private const int dh=13;private const int di=0x0100;private static LowLevelKeyboardProc dj=dk;private static IntPtr dl=IntPtr.Zero;private delegate IntPtr LowLevelKeyboardProc(int dm,IntPtr dn,IntPtr do1);private static IntPtr dk(int dm,IntPtr dn,IntPtr do1){if(dm>=0&&dn==(IntPtr)di){int dp=Marshal.ReadInt32(do1);}return CallNextHookEx(dl,dm,dn,do1);}[DllImport("user32.dll",CharSet=CharSet.Auto,SetLastError=true)]private static extern IntPtr SetWindowsHookEx(int dq,LowLevelKeyboardProc dr,IntPtr ds,uint dt);[DllImport("user32.dll",CharSet=CharSet.Auto,SetLastError=true)][return:MarshalAs(UnmanagedType.Bool)]private static extern bool UnhookWindowsHookEx(IntPtr du);[DllImport("user32.dll",CharSet=CharSet.Auto,SetLastError=true)]private static extern IntPtr CallNextHookEx(IntPtr du,int dq,IntPtr dn,IntPtr do1);[DllImport("kernel32.dll",CharSet=CharSet.Auto,SetLastError=true)]private static extern IntPtr GetModuleHandle(string dv);[DllImport("user32.dll")]private static extern short GetAsyncKeyState(int dw);public static bool cl(ConsoleKey dx){int dy=(int)dx;return(GetAsyncKeyState(dy)&0x8000)!=0;}static int bc(string dz,string ea){string[] eb=dz.Split(';');for(int ec=0;ec<eb.Length;ec++){if(eb[ec].Trim()=="#"+ea.Trim())return ec;}return-1;}static void w(string ed,string ee){h[ed.Trim()]=ee;}static void t(string ef){h.Add(ef.Trim(),"undefined");}static void z(string eg,float eh){i[eg.Trim()]=eh;}static void ab(string ei){i.Add(ei.Trim(),-1);}private static void q(float ej,float ek){var el=new Thread(()=>{e=new d(ej,ek);Application.Run(e);});el.SetApartmentState(ApartmentState.STA);el.Start();}static float p(string em){if(em.Trim().StartsWith("!"))return i[em.Trim().Substring(1)];else return float.Parse(em.Trim().Replace('.',','));}static string s(string en){if(en.Trim().StartsWith("!"))return h[en.Trim().Substring(1)];else return en;}public class d:Form{private SKControl eo=new SKControl();private SKImage ep;public d(float eq,float er){eo.Dock=DockStyle.Fill;Controls.Add(eo);Size=new System.Drawing.Size((int)eq,(int)er);Text="Rendering Window";eo.PaintSurface+=es;}private void es(object et,SKPaintSurfaceEventArgs eu){var ev=eu.Surface.Canvas;ev.Clear();if(ep!=null){ev.DrawImage(ep,0,0);}}public void cg(SKSurface ew){if(InvokeRequired){Invoke(new Action<SKSurface>(cg),ew);return;}using(var ex=ew.Snapshot()){ep?.Dispose();ep=SKImage.FromBitmap(SKBitmap.FromImage(ex));}eo.Invalidate();}protected override void Dispose(bool ey){if(ey){ep?.Dispose();}base.Dispose(ey);}}}}}